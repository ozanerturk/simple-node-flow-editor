var $=Object.defineProperty;var C=(n,e,t)=>e in n?$(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var s=(n,e,t)=>(C(n,typeof e!="symbol"?e+"":e,t),t);import{d as I,o as r,c as h,F as x,r as w,a as c,t as v,n as L,p as A,b as k,e as S,L as B,f as M,u as D,w as F,g as V,h as j,i as q}from"./vendor.b5ac2eec.js";const P=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}};P();class R{constructor(){s(this,"nodes",[])}execute(){this.nodes.forEach(e=>e.tryExecution())}addNewNode(e){this.nodes.push(e)}attachNode(e,t){let u=this.nodes.flatMap(o=>o.outputs).find(o=>o.attachedInputs.some(a=>a.id===t.id));u&&u.detachInput(t),e.attachInput(t)}}function N(){var n,e,t;for(n="",t=0;t<32;t++)(t==8||t==12||t==16||t==20)&&(n=n+"-"),e=Math.floor(Math.random()*16).toString(16).toUpperCase(),n=n+e;return n}class T{constructor(e){s(this,"inputs",[]);s(this,"outputs",[]);s(this,"name");s(this,"x",0);s(this,"y",0);s(this,"id");this.name=e,this.id=N()}canExecute(){return console.log(this.inputs.length,this.inputs.map(e=>e.hasValue())),this.inputs.every(e=>e.hasValue())}tryExecution(){this.canExecute()?this.execution():this.notReady()}updateCoordinates(e,t){this.x=e,this.y=t}notReady(){console.log(this,"not ready")}}class E{constructor(e){s(this,"value");s(this,"hasValue",!1);this.value=e}setValue(e){this.value=e,this.hasValue=!0}clear(){this.value=null,this.hasValue=!1}}class z{constructor(e,t){s(this,"name");s(this,"node");s(this,"value",new E(null));s(this,"attachedInputs",[]);s(this,"id");this.node=e,this.name=t,this.id=N()}getValue(){return this.value.value}setValue(e){this.value.setValue(e),this.notifyAttachedInputs(),console.log("attached inputs notified")}notifyAttachedInputs(){for(let e of this.attachedInputs)e.setValue(this.value.value),console.log("attached input values set to ",this.value.value)}detachInput(e){this.attachedInputs.splice(this.attachedInputs.findIndex(t=>t.id==e.id),1)}attachInput(e){this.attachedInputs.push(e)}}class G{constructor(e,t){s(this,"name");s(this,"required",!0);s(this,"default");s(this,"value",new E(null));s(this,"node");s(this,"id");this.node=e,this.name=t,this.id=N()}hasValue(){return this.value.hasValue}setValue(e){this.value.setValue(e)}getValue(){return this.value.value}clearValue(){this.value.clear()}}class y extends T{constructor(){super("Engine");s(this,"powerInput",new G(this,"power"));s(this,"powerOutput",new z(this,"power"));this.inputs.push(this.powerInput),this.outputs.push(this.powerOutput)}execution(){let e=this.powerInput.getValue()*2;this.powerOutput.setValue(e),console.log("power output set to",e)}}var O=(n,e)=>{const t=n.__vccOpts||n;for(const[u,o]of e)t[u]=o;return t};const K=n=>(A("data-v-f5153a8a"),n=n(),k(),n),U=K(()=>c("div",{class:"input-titles"},null,-1)),H={class:"inputs"},J=["id"],Q={class:"input-name"},W={class:"center"},X={class:"outputs"},Y=["id"],Z={class:"output-name"},ee=I({props:{node:Object},setup(n){return(e,t)=>{var u,o,a;return r(),h("div",{class:"box",style:L({left:n.node.x+"px",top:n.node.y+"px"})},[U,(r(!0),h(x,null,w((u=n.node)==null?void 0:u.inputs,(i,f)=>{var p;return r(),h("div",H,[c("div",{id:`node-${(p=n.node)==null?void 0:p.id}-input-${i.id}`,class:"input"},[c("div",Q,v(i.name)+"("+v(i.getValue())+")",1)],8,J)])}),256)),c("div",W,v((o=n.node)==null?void 0:o.name),1),(r(!0),h(x,null,w((a=n.node)==null?void 0:a.outputs,(i,f)=>{var p;return r(),h("div",X,[c("div",{id:`node-${(p=n.node)==null?void 0:p.id}-output-${i.id}`,class:"output"},[c("div",Z,v(i.name)+" ("+v(i.getValue())+")",1)],8,Y)])}),256))],4)}}});var te=O(ee,[["__scopeId","data-v-f5153a8a"]]);const ne={style:{"margin-left":"100px"}},oe=I({setup(n){let e=S(new R),t=new y,u=new y,o=[];e.value.addNewNode(t),e.value.addNewNode(u),e.value.attachNode(t.powerOutput,u.powerInput),e.value.execute(),t.powerInput.setValue(100),e.value.execute(),f();function a(){e.value.addNewNode(engine3),e.value.attachNode(t.powerOutput,engine3.powerInput),e.value.execute()}function i(){let l=new y,d=e.value.nodes[e.value.nodes.length-1];e.value.addNewNode(l),e.value.attachNode(d.powerOutput,l.powerInput),e.value.execute(),console.log(e.value),f()}function f(){o.forEach(l=>{l.remove()}),o=[];for(let l of e.value.nodes.flatMap(d=>d.outputs).filter(d=>d.attachedInputs.length)){console.log("output",l);for(let d of l.attachedInputs){let _=`node-${l.node.id}-output-${l.id}`,g=`node-${d.node.id}-input-${d.id}`;console.log(_,g),setTimeout(()=>{let m=new B(document.getElementById(_),document.getElementById(g));o.push(m)},1)}}}function p(){o.forEach(l=>{setTimeout(()=>{l.position()},2)})}return(l,d)=>{const _=M("draggable");return r(),h("div",ne,[(r(!0),h(x,null,w(D(e).nodes,(g,m)=>F((r(),V(te,{onMove:p,class:"box",key:m,node:g},null,8,["node"])),[[_,{grid:[50,50]}]])),128)),c("button",{onClick:a},"attach and execute"),c("button",{onClick:i},"changeattachmentAndExecute")])}}});var se=O(oe,[["__scopeId","data-v-3730fa65"]]);const ae=I({setup(n){return(e,t)=>(r(),V(se))}}),b=j(ae);b.use(q);b.mount("#app");
